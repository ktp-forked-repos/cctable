\usepackage{listings}
\definecolor{ListingBar}{rgb}{0.8,0.8,0.8}
\definecolor{ListingBG}{rgb}{0.95,0.95,0.95}
\definecolor{Comment}{rgb}{0.4,0.4,0.4}
\definecolor{Pale}{rgb}{0.6,0.6,0.6}

\lstdefinelanguage[SWI]{Prolog}{
  mathescape=true,
  morecomment=[l]\%,
  morecomment=[s]{/*}{*/},
  morestring=[bd]``,
  % alternatively, typeset variables in upright Roman.
  % emph={X,Y,Z,M,N,N1,N2,I1,I2,P,P1,P2,L},
  moredelim=[is][]{@}{@},
  moredelim=[is][\itshape\bfseries]{~}{~},
  morekeywords={op,repeat,var,nonvar,ground,module},
  morekeywords=[2]{meta_predicate,is,table,true,false},
  literate={+}{{$+$}}1 
           {-}{{$-$}}1 
           {<>}{{$\neq$}}1 
           {>}{{$>$}}1 
           {<}{{$<$}}1 
           {>=}{{$\geq$}}2 
           {=}{{$=$ }}1%
           {=..}{{$=\!..$ }}2%
           {=<}{{$\leq$}}2 
           {==}{{$=\!=$ }}1%
           {==>}{{$\Rightarrow$ }}2
           {<=>}{{$\Leftrightarrow$ }}2%
           {->}{{$\rightarrow$ }}2%
           {:-}{{$\leftarrow$ }}2%
           {-->}{{$\longrightarrow$ }}3%
           % {~}{{$\sim$}}1%
           {\\+}{{$\neg$}}1%
           {]}{{$\,$]}}1%  space before list end
           {|}{{$\,|$}}2
           % {|}{{$\mid$}}1
           {&}{{\$}}1%     dollar sign: use ampersand
           % lambdas?
           {\\}{{$\lambda$}}1
           {^}{{$.$}}1
           % variables with numerical subscripts
           {K0}{{$K_0$}}2
           {K1}{{$K_1$}}2
           {Ys1}{{$\mathit{Ys}_1$}}3
           {Ys2}{{$\mathit{Ys}_2$}}3
           {R0}{{$R_0$}}2
           {A1}{{$A_1$}}2
           {A2}{{$A_2$}}2
           {A3}{{$A_3$}}2
           {M1}{{$M_1$}}2
           {M2}{{$M_2$}}2
           {N1}{{$N_1$}}2
           {N2}{{$N_2$}}2
           {N3}{{$N_3$}}2
           {S1}{{$S_1$}}2
           {S2}{{$S_2$}}2
           {S3}{{$S_3$}}2
           {T1}{{$T_1$}}2
           {T2}{{$T_2$}}2
           {Y1}{{$Y_1$}}2
           {Ky}{{$K_y$}}2
  }[keywords,comments,strings]%

\lstnewenvironment{prolog-barred} {\lstset{%
   basicstyle=\ttfamily\small,
   identifierstyle=\upshape, 
   emphstyle=\mdseries,
   % backgroundcolor=\color{ListingBG},
   commentstyle=\mdseries,
   frame=leftline,
   framerule=0.4em,
   rulecolor=\color{ListingBar},
   framesep=1em,
   framexleftmargin=0em,
   mathescape=true,
   language=[SWI]Prolog,
   columns=spaceflexible,
   % aboveskip=0.75em,
   % belowskip=0.75em,
   xleftmargin=1.2em,
   xrightmargin=1.2em,
   tabsize=2,
   gobble=2
  }} {}

\lstnewenvironment{prolog}[1][]{\lstset{%
  language=[SWI]Prolog,
  columns=spaceflexible,
  aboveskip=1.00em,
  belowskip=1.00em,
  xleftmargin=2.0em,
  tabsize=2,
  gobble=2,
  #1
  }} {}

\lstnewenvironment{prolog-framed}[1][]{\lstset{%
  language=[SWI]Prolog,
  columns=flexible,
 % \\ keywordstyle=\bfseries,
  frame=lines,
  aboveskip=1.1em,
  belowskip=1.1em,
  framexleftmargin=1.8em,
  xleftmargin=1.8em,
  framexrightmargin=0em,
  xrightmargin=0em,
  framesep=0.4em,
  tabsize=2,
  gobble=2,
  numbersep=1em,
  % numbers=right,
  stepnumber=4,
  firstnumber=auto,
  numberstyle=\small\color{Pale},
  #1
  }} {}

